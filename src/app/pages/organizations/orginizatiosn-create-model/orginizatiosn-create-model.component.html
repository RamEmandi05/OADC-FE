<ol class="breadcrumb float-xl-end">
    <li class="breadcrumb-item"><a href="javascript:;">Home</a></li>
    <li class="breadcrumb-item"><a href="javascript:;">Manage Organization Models</a></li>

</ol>
<!-- END breadcrumb -->
<!-- BEGIN page-header -->
<app-ngxloader [ngxloader]="ngxloading"></app-ngxloader>

<h1 class="page-header">Create Organization Models </h1>
<div class="d-flex align-items-center mb-3">
 
    <div class="ms-auto"> 
        <a href="#modal-dialog" data-bs-target="#modelStaticBackdrop" class="btn btn-primary m-2" data-bs-toggle="modal" *ngIf="isAdmin || this.userProfile.role == 'OrganizationAdmin'" (click)="addOrganizationUser()"><i class="fas fa-plus"></i> Add Model</a>
        
    </div>
</div>

<!-- <div *ngIf="organizationUserPagePer.create"> -->
<div>
    <div class="row mb-15px" *ngIf="(isAdmin || this.userProfile.role == 'OrganizationAdmin') && organizations && organizations.length > 1">
       

        <label class="form-label col-form-label col-md-1">Select Organization</label>
        <div class="col-md-4">
            <select class="form-select" (change)="changeOrganization()" [(ngModel)]="selectedOrganizationId">
                <option *ngFor="let ozn of organizations" [ngValue]="ozn._id">{{ozn.organizationName}}</option>
            </select>
        </div>


    </div>
</div>
 


<div class="row">
    <div class="col-xl-12">
         
        <p-table #orgUsers styleClass="p-datatable-sm" [value]="organizationsModels" selectionMode="single"
            dataKey="email" [lazy]="false" [paginator]="true" [rows]="10" (onRowSelect)="onRowSelect($event)"
            [totalRecords]="organizationsModelsCount" [loading]="loading"
            [globalFilterFields]="['orgName','model']"  >
            
            <ng-template pTemplate="caption">
                <div class="row flex" *ngIf="organizationsModels && organizationsModels.length>0">
                    <div class="col-md-4">
                        &nbsp;&nbsp;&nbsp;<button style="padding: 0px 0px !important;
                width: 2rem;" type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel()"
                            class="p-button-success mr-2" pTooltip="XLS" tooltipPosition="bottom"></button>
                    </div>
                    <div class="col-md-8" style="text-align: right;">
                        <span class="" style="padding-right:4px">
                            <button style="padding: 2px 2px !important; width:4rem;" type="button"
                                (click)="refreshGrid()" class="p-element btn btn-default btn-lg border" pTooltip="Refresh Grid" tooltipPosition="top"> 
                                <i class="fas fa-arrows-rotate"></i>
                            </button>
                        </span>
                        <span class="p-input-icon-left ml-auto">
                            <i class="pi pi-search"></i>
                            <input style="padding: 2px 2.5rem;" pInputText type="text"
                                (input)="orgUsers.filterGlobal($event.target.value, 'contains')"
                                placeholder="Search keyword" />
                        </span>
                    </div>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="orgName">Org Name <p-sortIcon field="orgName"></p-sortIcon></th>
                    <th pSortableColumn="model">Org Model Name <p-sortIcon field="model"></p-sortIcon></th>
                    <th class="text-center">View Data </th>
                    <th class="text-center">TSN-AI </th>
                    <th class="text-center">Delete Model </th>
                    
                    <!-- <th *ngIf="organizationUserPagePer.create || isAdmin">Actions</th> -->
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-orgmodel>
                <tr>
                    <td>{{orgmodel.orgName}}</td>    
                    <td>{{orgmodel.model}}</td>
                    <td class="text-center"><a class="btn btn-md btn-icon btn-circle  btn-default"
                        (click)="gotoDataTab(orgmodel)"><i
                            class="fas fa-eye"></i></a> </td>
                    <td class="text-center"><a class="btn btn-md btn-icon btn-circle  btn-success"
                        (click)="gotoTsnaiTab(orgmodel)"><i
                            class="fas fa-brain"></i></a> </td>
                    <td class="text-center"><a class="btn btn-md btn-icon btn-circle btn-danger"
                        (click)="deleteModel(orgmodel)"><i
                            class="fas fa-trash"></i></a> </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" *ngIf="!organizationsModels" pTemplate="emptymessage">
                <tr>
                    <td class="text-center" colspan="5">No data found </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="paginatorleft" let-state>
                Total Records - {{state.totalRecords}}
                <!-- Showing {{(state.page  * state.rows) + 1}} to {{state.rows * (state.page + 1)}} of {{state.totalRecords}} -->
            </ng-template>
        </p-table>
    </div>
</div>
<!-- #modal-dialog -->
<div class="modal fade" id="modal-dialog" id="modelStaticBackdrop" data-bs-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Add Organization Model</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
            </div>
            <form #f="ngForm" (ngSubmit)="formSubmit(f)" class="fs-13px">
                <div class="modal-body">
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Model / Bucket Name <span class="text-red">*</span></label>
                            <input type="text" name="organizationModel" class="form-control" placeholder="Model Name" minlength="3" maxlength="42" required
                                [(ngModel)]="orgModel.organizationModel">
                        </div>

                        <div class="mb-3" *ngIf="isAdmin || this.userProfile.role == 'OrganizationAdmin'">
                            <label class="form-label">Connection Type <span class="text-red">*</span></label>
                            <select class="form-select" [(ngModel)]="orgModel.connectionType" name="connectionType" required>
                                <option *ngFor="let ct of connectionTypes" [ngValue]="ct.id">{{ct.name}}
                                </option>
                            </select>
                        </div>

                        <div class="mb-3" *ngIf="isAdmin || this.userProfile.role == 'OrganizationAdmin'">
                            <label class="form-label">Organization <span class="text-red">*</span></label>
                            <select class="form-select" [(ngModel)]="orgModel.organizationId" name="selectedOrganizationId" required>
                                <option *ngFor="let ozn of organizations" [ngValue]="ozn._id">{{ozn.organizationName}}
                                </option>
                            </select>
                        </div>
 
                    </div>
                </div>
                <div class="modal-footer">
                    <a #hidden href="javascript:;" class="btn btn-white" data-bs-dismiss="modal">Close</a>
                    <button type="submit" aria-hidden="true" class="btn btn-success" data-bs-dismiss="modal" [class.disabled]="!f.form.valid"> Save</button>
                </div>
            </form>
        </div>
    </div>
</div>
 

